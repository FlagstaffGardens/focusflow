version: "3.9"

services:
  focusflow:
    build:
      context: .
      dockerfile: Dockerfile
    image: focusflow:latest
    ports:
      - "8080:8080"
    env_file:
      - .env
    environment:
      # API URL for frontend to connect to backend
      REFLEX_API_URL: http://localhost:8080
      # Data storage
      FILES_DIR: /data/files
      DATABASE_URL: sqlite:////data/app.db
      # Pass through API keys from .env file
      ASSEMBLYAI_API_KEY: ${ASSEMBLYAI_API_KEY}
      OPENAI_API_KEY: ${OPENAI_API_KEY}
      OPENAI_BASE_URL: ${OPENAI_BASE_URL}
      OPENAI_MODEL: ${OPENAI_MODEL}
    volumes:
      - focusflow-data:/data
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  focusflow-data:
    driver: local
